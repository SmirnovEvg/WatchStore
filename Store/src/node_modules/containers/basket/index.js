import React from 'react'
import {connect} from 'react-redux'
import R from 'ramda'
import {Link} from 'react-router'

import {
    getBasketWatchesWithCount,
    getTotalBasketPrice
} from 'selectors'

import{
  removeWatchFromBasket,
  basketCheckout,
  cleanBasket
} from 'actions'

import Footer from 'components/footer';
import Header from 'components/header';

const Basket = ({watches, totalPrice, removeWatchFromBasket, basketCheckout, cleanBasket}) => {
    const isBasketEmpty = R.isEmpty(watches)

  
    const renderContent = () => {
      return (
        <div>
          {isBasketEmpty && <div className='basketEmpty'>Ваша корзина пуста</div>}
  
          <div className='basket-list'>
            <table className='basket-list-table'>
              <tbody>
              {watches.map((watch, index) => (
                <tr
                  key={index}
                  className='basket-list-table-item'
                >
                  <td className='first-table-column'>
                    <img
                      className='img-thumbnail'
                      src={watch.image}
                      alt={watch.name}
                    />
                  </td>
                  <td>{watch.name}</td>
                  <td>{watch.price} руб.</td>
                  <td className='count-basket-item'>{watch.count}</td>
                  <td className='delete-btn'>
                      <img 
                      src="/images/icons8-cancel-50.png" 
                      alt="Close"
                      onClick={() => removeWatchFromBasket(watch.id)}
                      />
                  </td>
                </tr>
              ))}
              </tbody>
            </table>
          </div>
          {
            R.not(isBasketEmpty) &&
            <div className='row'>
              <div className='total-price'>
                Итого к оплате: {totalPrice} руб.
              </div>
            </div>
          }
        </div>
      )
    }
  
    const renderSidebar = () => (
      <div className='sidebarBasket'>
       <Link 
       to='/catalog'
       className='btn_toStore btn_BasketToStore'
       >
       Вернуться в каталог
       </Link>
       {
         R.not(isBasketEmpty) &&
         <div>
           <button
           onClick={cleanBasket}
           className='btn_toStore btn_Clean'
           >
            Очистить корзину
           </button>
           <button
           onClick={() => basketCheckout(watches)}
           className='btn_toStore btn_Checkout'
           >
            Оформить заказ
           </button>
         </div>
       }
      </div>
    )
  
    return (
      <div className='view-container'>
        <Header />
        <div className='container'>
          <div className='row flex-row-reverse'>
            <div className='col-md-3 btn-user-checkout'>
              {renderSidebar()}
            </div>
            <div className='col-md-9'>
              {renderContent()}
            </div>
          </div>
        </div>
        <Footer />
      </div>
    )
}  

const mapStateToProps = state => {
  return {
    watches: getBasketWatchesWithCount(state),
    totalPrice: getTotalBasketPrice(state)
  }
}

const mapDispatchToProps = {
  removeWatchFromBasket,
  basketCheckout,
  cleanBasket
}
  
  export default connect(mapStateToProps, mapDispatchToProps)(Basket)
  
